<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Calendar</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .calendar { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(17, 2em); gap: 1px; }
        .calendar > div { border: 1px solid #ccc; position: relative; }
        .time-slot { height: 2em; }
        .event { position: absolute; background-color: #87CEFA; border: 1px solid #00BFFF; border-radius: 4px; padding: 2px; box-sizing: border-box; cursor: pointer; }
        .highlight { background-color: rgba(135, 206, 250, 0.5); }
        #current-time { position: absolute; height: 1px; width: 100%; background: red; pointer-events: none; }
        .event-name { position: absolute; background: white; border: 1px solid #ccc; display: none; }
        .day { width: 100%; text-align: center; margin: 5px 0; }
        .today-btn { margin: 10px; }
    </style>
</head>
<body>
    <button class="today-btn" onclick="scrollToCurrentTime()">Today</button>
    <div class="calendar">
        <div class="day">Monday</div><div class="day">Tuesday</div><div class="day">Wednesday</div><div class="day">Thursday</div><div class="day">Friday</div>
    </div>
    <div id="eventNamePopup" class="event-name">
        <input type="text" id="eventNameInput" placeholder="Event name">
        <button onclick="saveEventName()">Save</button>
    </div>
    <div id="current-time"></div>
    <script>
        const startHour = 9, endHour = 17, timeSlotMins = 30;
        const calendar = document.querySelector('.calendar');
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
        const currentEvents = {};
        let selectedEvent = null, startY = 0, isDragging = false;

        function createGrid() {
            const timeSlotCount = (endHour - startHour) * (60 / timeSlotMins);
            for (let i = 1; i <= timeSlotCount; i++) {
                const time = new Date(new Date().setHours(startHour, (i - 1) * timeSlotMins));
                days.forEach(day => {
                    const cell = document.createElement('div');
                    cell.classList.add('time-slot');
                    cell.dataset.time = time.toTimeString().substr(0, 5);
                    cell.dataset.day = day;
                    calendar.appendChild(cell);
                });
            }
        }

        function initializeEvents() {
            let eventId = 0;
            calendar.addEventListener('mousedown', e => {
                if (e.target.classList.contains('time-slot')) {
                    isDragging = true;
                    startY = e.clientY;
                    const event = createEventElement(e.target.dataset.day, e.target.dataset.time);
                    selectedEvent = {
                        element: event,
                        startTime: e.target.dataset.time,
                        day: e.target.dataset.day,
                        eventId: ++eventId,
                        startCell: e.target
                    };
                    document.body.appendChild(event);
                }
            });

            document.addEventListener('mousemove', e => {
                if (isDragging && selectedEvent) {
                    const endY = e.clientY;
                    const height = Math.max(2, Math.round((endY - startY) / 2));
                    selectedEvent.element.style.height = `${height}em`;
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && selectedEvent) {
                    const endTime = calculateEndTime(selectedEvent.startTime, selectedEvent.element.style.height);
                    if (areEventsOverlapping(selectedEvent.day, selectedEvent.startTime, endTime)) {
                        alert('Overlapping events are not allowed');
                        selectedEvent.element.remove();
                    } else {
                        saveEvent(selectedEvent);
                        showEventNamePopup(selectedEvent.element);
                    }
                    isDragging = false;
                    selectedEvent = null;
                }
            });
        }

        function createEventElement(day, startTime) {
            const event = document.createElement('div');
            event.classList.add('event');
            event.dataset.day = day;
            event.dataset.startTime = startTime;
            event.innerHTML = `<span>${startTime} - </span>`;
            event.addEventListener('click', e => {
                if (confirm('Do you want to delete this event?')) {
                    const eventId = e.currentTarget.dataset.id;
                    delete currentEvents[eventId];
                    e.currentTarget.remove();
                }
            });
            return event;
        }

        function calculateEndTime(startTime, height) {
            const start = new Date(`1970-01-01T${startTime}:00`);
            const end = new Date(start.getTime() + (parseInt(height) * 30 * 60 * 1000));
            return end.toTimeString().substr(0, 5);
        }

        function saveEvent(event) {
            const {startTime, day, element, eventId} = event;
            const endTime = calculateEndTime(startTime, element.style.height);
            element.dataset.endTime = endTime;
            element.querySelector('span').textContent = `${startTime} - ${endTime}`;
            currentEvents[eventId] = {startTime, endTime, day, element};
        }

        function areEventsOverlapping(day, startTime, endTime) {
            for (const key in currentEvents) {
                const ev = currentEvents[key];
                if (ev.day === day && (
                    (ev.startTime <= startTime && ev.endTime > startTime) ||
                    (ev.startTime < endTime && ev.endTime >= endTime) ||
                    (ev.startTime >= startTime && ev.endTime <= endTime)
                )) return true;
            }
            return false;
        }

        function showEventNamePopup(eventElement) {
            const popup = document.getElementById('eventNamePopup');
            popup.style.display = 'block';
            popup.style.top = eventElement.offsetTop + 'px';
            popup.style.left = eventElement.offsetLeft + 'px';
            popup.dataset.eventId = eventElement.dataset.id;
        }

        function saveEventName() {
            const popup = document.getElementById('eventNamePopup');
            const eventId = popup.dataset.eventId;
            const input = document.getElementById('eventNameInput');
            const event = currentEvents[eventId];
            if (event) {
                event.element.innerHTML = `<span>${event.startTime} - ${event.endTime}<br>${input.value}</span>`;
                popup.style.display = 'none';
                input.value = '';
            }
        }

        function scrollToCurrentTime() {
            const current = new Date();
            if (current.getHours() >= startHour && current.getHours() < endHour) {
                window.scrollTo(0, (current.getHours() - startHour) * 2 * 16);
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            if (now.getHours() >= startHour && now.getHours() < endHour) {
                const currentTimeLine = document.getElementById('current-time');
                const timeSlotHeight = 32;
                const percentOfHour = now.getMinutes() / 60;
                currentTimeLine.style.top = `${(now.getHours() - startHour) * timeSlotHeight + percentOfHour * timeSlotHeight}px`;
                currentTimeLine.style.display = 'block';
            }
        }

        createGrid();
        initializeEvents();
        setInterval(updateCurrentTime, 60000);
        updateCurrentTime();
    </script>
</body>
</html>